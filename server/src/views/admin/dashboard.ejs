<%- include('../layouts/main', {
    title: 'Dashboard | Portfolio Admin',
    currentPage: 'dashboard',
    stats: stats,
    recentProjects: recentProjects,
    recentMessages: recentMessages,
    recentActivity: recentActivity,
    body: `
    <div class="row">
        <!-- Stats Cards -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Total Projects</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">${stats && stats.projectCount !== undefined ? stats.projectCount : '0'}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-project-diagram fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                            Total Messages</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800"><%= stats && stats.messageCount !== undefined ? stats.messageCount : '0' %></div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-envelope fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                            Unread Messages</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800"><%= stats && stats.unreadCount !== undefined ? stats.unreadCount : '0' %></div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-comments fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                            Total Users</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800"><%= stats && stats.userCount !== undefined ? stats.userCount : '0' %></div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-users fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Recent Projects -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                <h6 class="m-0 font-weight-bold text-primary">Recent Projects</h6>
                <a href="/admin/projects/new" class="btn btn-sm btn-primary">
                    <i class="fas fa-plus"></i> Add New
                </a>
            </div>
            <div class="card-body">
                <% if (recentProjects && recentProjects.length > 0) { %>
                    <div class="list-group list-group-flush">
                        <% recentProjects.forEach(project => { %>
                            <a href="/admin/projects/<%= project._id %>" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1"><%= project.title %></h6>
                                    <small class="text-muted"><%= new Date(project.createdAt).toLocaleDateString() %></small>
                                </div>
                                <p class="mb-1 text-muted"><%= project.shortDescription || 'No description available' %></p>
                                <small class="text-muted">
                                    <%= project.technologies ? project.technologies.slice(0, 3).join(', ') : '' %>
                                    <%= project.technologies && project.technologies.length > 3 ? '...' : '' %>
                                </small>
                            </a>
                        <% }); %>
                    </div>
                    <div class="mt-3 text-end">
                        <a href="/admin/projects" class="btn btn-sm btn-link">View All Projects</a>
                    </div>
                <% } else { %>
                    <div class="text-center py-4">
                        <i class="fas fa-inbox fa-3x text-gray-300 mb-3"></i>
                        <p class="text-muted">No projects found</p>
                        <a href="/admin/projects/new" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus"></i> Add Your First Project
                        </a>
                    </div>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Recent Messages -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                <h6 class="m-0 font-weight-bold text-primary">Recent Messages</h6>
                <a href="/admin/messages" class="btn btn-sm btn-primary">
                    <i class="fas fa-envelope"></i> View All
                </a>
            </div>
            <div class="card-body">
                <% if (recentMessages && recentMessages.length > 0) { %>
                    <div class="list-group list-group-flush">
                        <% recentMessages.forEach(message => { %>
                            <a href="/admin/messages/<%= message._id %>" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1"><%= message.name %></h6>
                                    <small class="<%= message.status === 'new' ? 'text-primary' : 'text-muted' %>">
                                        <%= new Date(message.createdAt).toLocaleDateString() %>
                                    </small>
                                </div>
                                <p class="mb-1"><%= message.subject %></p>
                                <p class="mb-1 text-muted"><%= message.message.substring(0, 100) %><%= message.message.length > 100 ? '...' : '' %></p>
                                <small class="badge bg-<%= message.status === 'new' ? 'primary' : message.status === 'replied' ? 'success' : 'secondary' %>">
                                    <%= message.status.charAt(0).toUpperCase() + message.status.slice(1) %>
                                </small>
                            </a>
                        <% }); %>
                    </div>
                <% } else { %>
                    <div class="text-center py-4">
                        <i class="fas fa-inbox fa-3x text-gray-300 mb-3"></i>
                        <p class="text-muted">No messages yet</p>
                        <p class="small text-muted">New messages will appear here</p>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</div>

<!-- Activity Timeline -->
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Recent Activity</h6>
    </div>
    <div class="card-body">
        <% if (recentActivity && recentActivity.length > 0) { %>
            <div class="timeline">
                <% recentActivity.forEach(activity => { %>
                    <div class="timeline-item">
                        <div class="timeline-marker">
                            <i class="fas fa-circle fa-sm"></i>
                        </div>
                        <div class="timeline-content">
                            <div class="d-flex justify-content-between">
                                <h6 class="mb-1"><%= activity.title %></h6>
                                <small class="text-muted"><%= new Date(activity.date).toLocaleString() %></small>
                            </div>
                            <p class="mb-1"><%= activity.description %></p>
                            <% if (activity.link) { %>
                                <a href="<%= activity.link %>" class="btn btn-sm btn-outline-primary">View</a>
                            <% } %>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <div class="text-center py-4">
                <i class="fas fa-history fa-3x text-gray-300 mb-3"></i>
                <p class="text-muted">No recent activity</p>
            </div>
        <% } %>
    </div>
</div>

`,
    styles: `
    /* Timeline Styling */
    .timeline {
        position: relative;
        padding-left: 1.5rem;
        margin: 0 0 0 1rem;
        border-left: 2px solid #e3e6f0;
    }
    
    .timeline-item {
        position: relative;
        padding-bottom: 1.5rem;
        padding-left: 1.5rem;
    }
    
    .timeline-marker {
        position: absolute;
        left: -1.5rem;
        width: 1rem;
        text-align: center;
        color: #4e73df;
    }
    
    .timeline-content {
        padding: 1rem;
        background-color: #f8f9fc;
        border-radius: 0.35rem;
    }
    
    .timeline-item:last-child {
        padding-bottom: 0;
    }
    
    /* Card hover effect */
    .card {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    
    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.1) !important;
    }
    
    /* Status badges */
    .badge {
        font-weight: 500;
        padding: 0.35em 0.65em;
    }
`
}) %>
